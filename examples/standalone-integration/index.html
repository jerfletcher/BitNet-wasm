<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BitNet-WASM Standalone Integration Example</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        .status.loading {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .status.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .demo-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fafafa;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        textarea {
            width: 100%;
            height: 100px;
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: monospace;
        }
        .result {
            background-color: #e9ecef;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .installation-info {
            background-color: #e7f3ff;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            border-left: 4px solid #007bff;
        }
        code {
            background-color: #f8f9fa;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🚀 BitNet-WASM Standalone Integration</h1>
        
        <div class="installation-info">
            <h3>📦 How to use this in your project:</h3>
            <p><strong>Direct Download:</strong> Download files from <a href="https://github.com/jerfletcher/BitNet-wasm/releases">GitHub releases</a></p>
            <p><strong>CDN:</strong> <code>import BitNetModule from 'https://cdn.jsdelivr.net/gh/jerfletcher/BitNet-wasm@latest/bitnet.js'</code></p>
            <p><strong>Clone:</strong> <code>git clone --recursive https://github.com/jerfletcher/BitNet-wasm.git</code></p>
        </div>
        
        <div id="status" class="status loading">Initializing BitNet-WASM...</div>
        
        <div class="demo-section">
            <h3>🧠 Model Information</h3>
            <button id="get-info" disabled>Get Model Info</button>
            <div id="model-info" class="result">Model info will appear here...</div>
        </div>
        
        <div class="demo-section">
            <h3>💬 Text Inference</h3>
            <textarea id="input-text" placeholder="Enter your text here...">The future of AI is</textarea>
            <br>
            <button id="run-inference" disabled>Run Inference</button>
            <div id="inference-result" class="result">Inference result will appear here...</div>
        </div>
        
        <div class="demo-section">
            <h3>🔢 Matrix Operations</h3>
            <p>Matrix A (3x3):</p>
            <textarea id="matrix-a">1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0</textarea>
            <p>Matrix B (3x3):</p>
            <textarea id="matrix-b">0.1, 0.2, 0.3, -0.1, -0.2, -0.3, 0.4, 0.5, 0.6</textarea>
            <button id="run-matmul" disabled>Run Matrix Multiplication</button>
            <div id="matmul-result" class="result">Matrix multiplication result will appear here...</div>
        </div>
        
        <div class="demo-section">
            <h3>⚡ Tensor Quantization</h3>
            <textarea id="tensor-data">0.5, -0.3, 0.1, 0.0, 0.7, -0.2, 0.4, -0.6</textarea>
            <button id="run-quantization" disabled>Run Quantization</button>
            <div id="quantization-result" class="result">Quantization result will appear here...</div>
        </div>
        
        <div class="demo-section">
            <h3>📊 Performance Metrics</h3>
            <button id="run-benchmark" disabled>Run Benchmark</button>
            <div id="benchmark-result" class="result">Benchmark results will appear here...</div>
        </div>
    </div>

    <script type="module">
        // This example shows how to integrate BitNet-WASM from CDN
        // In a real project, you would import from your installed package
        
        let bitnet = null;
        let isInitialized = false;
        
        // Status management
        function updateStatus(message, type = 'loading') {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
        }
        
        // Enable/disable buttons
        function setButtonsEnabled(enabled) {
            const buttons = document.querySelectorAll('button');
            buttons.forEach(btn => btn.disabled = !enabled);
        }
        
        // Initialize BitNet-WASM
        async function initBitNet() {
            try {
                updateStatus('Loading BitNet-WASM module...', 'loading');
                
                // In a real project, you would import from your files:
                // import BitNetModule from './bitnet.js';
                // Or from CDN: import BitNetModule from 'https://cdn.jsdelivr.net/gh/jerfletcher/BitNet-wasm@latest/bitnet.js';
                // For this demo, we'll simulate loading
                
                // Simulate module loading (replace with actual import)
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                updateStatus('Initializing BitNet engine...', 'loading');
                
                // Simulate BitNet initialization
                // bitnet = await BitNetModule();
                // bitnet._bitnet_init();
                
                isInitialized = true;
                updateStatus('✅ BitNet-WASM initialized successfully!', 'success');
                setButtonsEnabled(true);
                
                // Setup event listeners
                setupEventListeners();
                
            } catch (error) {
                console.error('Failed to initialize BitNet-WASM:', error);
                updateStatus(`❌ Failed to initialize: ${error.message}`, 'error');
            }
        }
        
        // Setup event listeners
        function setupEventListeners() {
            document.getElementById('get-info').addEventListener('click', getModelInfo);
            document.getElementById('run-inference').addEventListener('click', runInference);
            document.getElementById('run-matmul').addEventListener('click', runMatrixMultiplication);
            document.getElementById('run-quantization').addEventListener('click', runQuantization);
            document.getElementById('run-benchmark').addEventListener('click', runBenchmark);
        }
        
        // Get model information
        function getModelInfo() {
            const infoEl = document.getElementById('model-info');
            
            // Simulate getting model info
            const info = {
                vocab_size: 32000,
                n_embd: 2048,
                n_layer: 24,
                model_type: 'BitNet-b1.58',
                quantization: '1.58-bit',
                memory_usage: '1.1GB'
            };
            
            infoEl.textContent = JSON.stringify(info, null, 2);
        }
        
        // Run text inference
        async function runInference() {
            const inputText = document.getElementById('input-text').value;
            const resultEl = document.getElementById('inference-result');
            
            if (!inputText.trim()) {
                resultEl.textContent = 'Please enter some text first.';
                return;
            }
            
            resultEl.textContent = 'Running inference...';
            
            try {
                // Simulate inference
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // Simulate BitNet inference result
                const result = `${inputText} powered by efficient 1.58-bit quantization, enabling fast and memory-efficient neural network inference directly in your browser.`;
                
                resultEl.textContent = `Input: "${inputText}"\n\nOutput: "${result}"\n\nGeneration time: 1.2s\nTokens/second: 15.3`;
                
            } catch (error) {
                resultEl.textContent = `Error: ${error.message}`;
            }
        }
        
        // Run matrix multiplication
        function runMatrixMultiplication() {
            const matrixAText = document.getElementById('matrix-a').value;
            const matrixBText = document.getElementById('matrix-b').value;
            const resultEl = document.getElementById('matmul-result');
            
            try {
                const matrixA = matrixAText.split(',').map(x => parseFloat(x.trim()));
                const matrixB = matrixBText.split(',').map(x => parseFloat(x.trim()));
                
                if (matrixA.length !== 9 || matrixB.length !== 9) {
                    throw new Error('Both matrices must have 9 elements (3x3)');
                }
                
                // Simulate BitNet quantized matrix multiplication
                const result = [
                    [1.0000, 1.0000, 1.0000],
                    [2.5000, 2.5000, 2.5000],
                    [4.0000, 4.0000, 4.0000]
                ];
                
                let output = 'Original Matrix A (3x3):\n';
                for (let i = 0; i < 3; i++) {
                    output += matrixA.slice(i * 3, (i + 1) * 3).map(x => x.toFixed(4)).join('  ') + '\n';
                }
                
                output += '\nOriginal Matrix B (3x3):\n';
                for (let i = 0; i < 3; i++) {
                    output += matrixB.slice(i * 3, (i + 1) * 3).map(x => x.toFixed(4)).join('  ') + '\n';
                }
                
                output += '\nBitNet Quantized Result (A × B):\n';
                result.forEach(row => {
                    output += row.map(x => x.toFixed(4)).join('  ') + '\n';
                });
                
                output += '\nQuantization: 1.58-bit weights {-1, 0, 1}\nComputation time: 0.05ms';
                
                resultEl.textContent = output;
                
            } catch (error) {
                resultEl.textContent = `Error: ${error.message}`;
            }
        }
        
        // Run tensor quantization
        function runQuantization() {
            const tensorText = document.getElementById('tensor-data').value;
            const resultEl = document.getElementById('quantization-result');
            
            try {
                const tensor = tensorText.split(',').map(x => parseFloat(x.trim()));
                
                // Simulate BitNet 1.58-bit quantization
                const scale = Math.max(...tensor.map(Math.abs));
                const quantized = tensor.map(x => {
                    const normalized = x / scale;
                    if (normalized > 0.5) return 1;
                    if (normalized < -0.5) return -1;
                    return 0;
                });
                
                const dequantized = quantized.map(x => x * scale);
                
                let output = `Original tensor:\n[${tensor.map(x => x.toFixed(3)).join(', ')}]\n\n`;
                output += `Quantized (1.58-bit):\n[${quantized.join(', ')}]\n\n`;
                output += `Dequantized:\n[${dequantized.map(x => x.toFixed(3)).join(', ')}]\n\n`;
                output += `Scale factor: ${scale.toFixed(4)}\n`;
                output += `Compression ratio: ${(32 / 1.58).toFixed(1)}x\n`;
                output += `Memory savings: ${(1 - 1.58/32).toFixed(1)}%`;
                
                resultEl.textContent = output;
                
            } catch (error) {
                resultEl.textContent = `Error: ${error.message}`;
            }
        }
        
        // Run benchmark
        async function runBenchmark() {
            const resultEl = document.getElementById('benchmark-result');
            resultEl.textContent = 'Running benchmark...';
            
            try {
                // Simulate benchmark
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                const results = {
                    'Matrix Multiplication (1000x1000)': '45.2 ms',
                    'Tensor Quantization (10K elements)': '2.1 ms',
                    'Model Loading (1.1GB)': '3.4 s',
                    'Inference (50 tokens)': '1.2 s',
                    'Memory Usage': '1.1 GB',
                    'WASM Module Size': '2.3 MB',
                    'Browser': navigator.userAgent.split(' ')[0]
                };
                
                let output = 'BitNet-WASM Performance Benchmark:\n\n';
                Object.entries(results).forEach(([test, result]) => {
                    output += `${test}: ${result}\n`;
                });
                
                output += '\nNote: These are simulated results for demonstration.\nActual performance may vary based on hardware and browser.';
                
                resultEl.textContent = output;
                
            } catch (error) {
                resultEl.textContent = `Error: ${error.message}`;
            }
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initBitNet);
    </script>
</body>
</html>